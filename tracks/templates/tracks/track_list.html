{% load static %}
<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>Каталог треків</title>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" type="image/png" href="/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="shortcut icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />
</head>
<body class="bg-neutral-950 text-neutral-100">
<header class="max-w-6xl mx-auto px-4 py-8">
    <div class="flex items-center justify-between">
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight">
            {% if active_genre %}Жанр: {{ active_genre.name }}{% else %}Каталог треків{% endif %}
        </h1>
        <a href="/" class="text-sm text-neutral-400 hover:text-white">← На головну</a>
    </div>

    <!-- Breadcrumb / шорткати -->
    <nav class="mt-2 text-sm flex items-center gap-2 text-neutral-400">
        <a href="/" class="hover:text-white">← На головну</a>
        <span class="opacity-60">/</span>
        <a href="/catalog/" class="hover:text-white">Каталог</a>
        {% if active_genre %}
          <span class="opacity-60">/</span>
          <span class="text-neutral-200">{{ active_genre.name }}</span>
          <a href="/catalog/"
             class="ml-3 inline-flex items-center px-2 py-0.5 rounded-full border border-neutral-700 hover:border-neutral-500">
              Скинути фільтр
          </a>
        {% endif %}
    </nav>

    <p class="text-neutral-400 mt-2">Слухай на сайті, тицяй “Замовити” — домовимось.</p>

    <!-- Чіпси жанрів -->
    <div class="mt-4 flex flex-wrap gap-2">
        <a href="/catalog/"
           class="text-xs px-3 py-1.5 rounded-full border bg-neutral-900
              {% if not active_genre %}border-neutral-500{% else %}border-neutral-800 hover:border-neutral-600{% endif %}">
            Всі
        </a>
        {% for g in genres %}
        <a href="/catalog/?genre={{ g.slug }}"
           class="text-xs px-3 py-1.5 rounded-full border bg-neutral-900
                {% if active_genre and active_genre.slug == g.slug %}border-neutral-500{% else %}border-neutral-800 hover:border-neutral-600{% endif %}">
            {{ g.name }}
        </a>
        {% endfor %}
    </div>

</header>



<main class="max-w-6xl mx-auto px-4 pb-16">
    <!-- Лічильник -->
    {% if page_obj %}
      <p class="text-sm text-neutral-400 mb-3">
        Показано {{ page_obj.start_index }}–{{ page_obj.end_index }} з {{ page_obj.paginator.count }}
      </p>
    {% endif %}

    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for track in tracks %}
        <article class="bg-neutral-900/60 border border-neutral-800 rounded-2xl overflow-hidden shadow-lg">
            <div class="aspect-video bg-black/40">
                {% if track.embed_url %}
                <iframe
                        class="w-full h-full"
                        src="{{ track.embed_url }}"
                        title="{{ track.title|escape }}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                ></iframe>
                {% else %}
                <div class="w-full h-full flex items-center justify-center text-neutral-500">
                    Невірний YouTube URL
                </div>
                {% endif %}
            </div>

            <div class="p-4">
                <h3 class="text-lg font-semibold">
                    <a href="{% url 'track_detail' slug=track.slug %}" class="hover:underline">
                        {{ track.title }}
                    </a>
                </h3>

                {% if track.description %}
                {% endif %}

                {% if track.is_featured %}
                <span class="inline-block mt-3 text-xs px-2 py-1 rounded-full bg-orange-500/20 text-orange-300 border border-orange-500/30">Featured</span>
                {% endif %}

                <div class="mt-4">
                    <a href="/order/?track={{ track.id }}"
                       class="inline-block px-4 py-2 rounded-xl bg-orange-500 text-neutral-900 font-medium hover:bg-orange-400 transition">
                        Замовити
                    </a>
                </div>

                <div class="mt-3 flex flex-wrap gap-2">
                    {% for g in track.genres.all %}
                    <a href="/catalog/?genre={{ g.slug }}"
                       class="text-xs px-2 py-1 rounded-full bg-neutral-800 border border-neutral-700 hover:border-neutral-500">
                        {{ g.name }}
                    </a>
                    {% empty %}{% endfor %}
                </div>
            </div>
        </article>
        {% empty %}
        <p class="text-neutral-400">Немає треків.</p>
        {% endfor %}
    </div>

    <!-- Пагінація -->
    {% if page_obj and page_obj.paginator.num_pages > 1 %}
      <div class="mt-10 flex justify-center">
        {% if active_genre %}
          {% with qs_prefix='?genre='|add:active_genre.slug|add:'&' %}
            <nav class="flex items-center gap-2 text-sm">
              {% if page_obj.has_previous %}
                <a href="{{ qs_prefix }}page=1"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">« Перша</a>
                <a href="{{ qs_prefix }}page={{ page_obj.previous_page_number }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">‹ Назад</a>
              {% endif %}

              {% with curr=page_obj.number last=page_obj.paginator.num_pages %}
                {% if curr > 3 %}
                  <a href="{{ qs_prefix }}page=1"
                     class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">1</a>
                     <span class="px-2 text-neutral-500">…</span>
                {% endif %}

                {% for n in page_obj.paginator.page_range %}
                  {% if n >= curr|add:-2 and n <= curr|add:2 %}
                    {% if n == curr %}
                      <span class="px-3 py-1 rounded-lg bg-orange-500 text-neutral-900 font-semibold">{{ n }}</span>
                    {% else %}
                      <a href="{{ qs_prefix }}page={{ n }}"
                         class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">{{ n }}</a>
                    {% endif %}
                  {% endif %}
                {% endfor %}

                {% if curr < last|add:-2 %}
                  <span class="px-2 text-neutral-500">…</span>
                  <a href="{{ qs_prefix }}page={{ last }}"
                     class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">{{ last }}</a>
                {% endif %}
              {% endwith %}

              {% if page_obj.has_next %}
                <a href="{{ qs_prefix }}page={{ page_obj.next_page_number }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">Вперед ›</a>
                <a href="{{ qs_prefix }}page={{ page_obj.paginator.num_pages }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">Остання »</a>
              {% endif %}
            </nav>
          {% endwith %}
        {% else %}
          {% with qs_prefix='?' %}
            <nav class="flex items-center gap-2 text-sm">
              {% if page_obj.has_previous %}
                <a href="{{ qs_prefix }}page=1"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">« Перша</a>
                <a href="{{ qs_prefix }}page={{ page_obj.previous_page_number }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">‹ Назад</a>
              {% endif %}

              {% with curr=page_obj.number last=page_obj.paginator.num_pages %}
                {% if curr > 3 %}
                  <a href="{{ qs_prefix }}page=1"
                     class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">1</a>
                  <span class="px-2 text-neutral-500">…</span>
                {% endif %}

                {% for n in page_obj.paginator.page_range %}
                  {% if n >= curr|add:-2 and n <= curr|add:2 %}
                    {% if n == curr %}
                      <span class="px-3 py-1 rounded-lg bg-orange-500 text-neutral-900 font-semibold">{{ n }}</span>
                    {% else %}
                      <a href="{{ qs_prefix }}page={{ n }}"
                         class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">{{ n }}</a>
                    {% endif %}
                  {% endif %}
                {% endfor %}

                {% if curr < last|add:-2 %}
                  <span class="px-2 text-neutral-500">…</span>
                  <a href="{{ qs_prefix }}page={{ last }}"
                     class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">{{ last }}</a>
                {% endif %}
              {% endwith %}

              {% if page_obj.has_next %}
                <a href="{{ qs_prefix }}page={{ page_obj.next_page_number }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">Вперед ›</a>
                <a href="{{ qs_prefix }}page={{ page_obj.paginator.num_pages }}"
                   class="px-3 py-1 rounded-lg bg-neutral-900 border border-neutral-800 hover:border-neutral-600">Остання »</a>
              {% endif %}
            </nav>
          {% endwith %}
        {% endif %}
      </div>
    {% endif %}
</main>

</body>
</html>
